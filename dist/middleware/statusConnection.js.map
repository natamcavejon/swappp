{"version":3,"file":"statusConnection.js","names":["statusConnection","req","res","next","client","isConnected","localArr","contactToArray","body","phone","isGroup","index","contact","numbers","indexOf","profile","checkNumberStatus","catch","error","console","log","numberExists","num","split","status","json","response","message","id","_serialized","push","logger"],"sources":["../../src/middleware/statusConnection.js"],"sourcesContent":["/*\n * Copyright 2021 WPPConnect Team\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { contactToArray } from '../util/functions';\n\nexport default async function statusConnection(req, res, next) {\n  try {\n    if (req.client && req.client.isConnected) {\n      await req.client.isConnected();\n\n      let localArr = contactToArray(req.body.phone || [], req.body.isGroup);\n\n      let index = 0;\n      for (const contact of localArr) {\n        if (req.body.isGroup) {\n          localArr[index] = contact;\n        } else if (numbers.indexOf(contact) < 0) {\n          let profile = await req.client.checkNumberStatus(contact).catch((error) => console.log(error));\n          if (!profile?.numberExists) {\n            const num = contact.split('@')[0];\n            return res.status(400).json({\n              response: null,\n              status: 'Connected',\n              message: `O número ${num} não existe.`,\n            });\n          } else {\n            if (numbers.indexOf(profile.id._serialized) < 0) {\n              numbers.push(profile.id._serialized);\n            }\n            localArr[index] = profile.id._serialized;\n          }\n        }\n        index++;\n      }\n      req.body.phone = localArr;\n    } else {\n      return res.status(404).json({\n        response: null,\n        status: 'Disconnected',\n        message: 'A sessão do WhatsApp não está ativa.',\n      });\n    }\n    next();\n  } catch (error) {\n    req.logger.error(error);\n    return res.status(404).json({\n      response: null,\n      status: 'Disconnected',\n      message: 'A sessão do WhatsApp não está ativa.',\n    });\n  }\n}\nlet numbers = [];\n"],"mappings":";;;;;;;;;;;;;;;;AAgBA,8CAAmD,CAhBnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAIe,eAAeA,gBAAgB,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE,CAC7D,IAAI,CACF,IAAIF,GAAG,CAACG,MAAM,IAAIH,GAAG,CAACG,MAAM,CAACC,WAAW,EAAE,CACxC,MAAMJ,GAAG,CAACG,MAAM,CAACC,WAAW,EAAE,CAE9B,IAAIC,QAAQ,GAAG,IAAAC,yBAAc,EAACN,GAAG,CAACO,IAAI,CAACC,KAAK,IAAI,EAAE,EAAER,GAAG,CAACO,IAAI,CAACE,OAAO,CAAC,CAErE,IAAIC,KAAK,GAAG,CAAC,CACb,KAAK,MAAMC,OAAO,IAAIN,QAAQ,EAAE,CAC9B,IAAIL,GAAG,CAACO,IAAI,CAACE,OAAO,EAAE,CACpBJ,QAAQ,CAACK,KAAK,CAAC,GAAGC,OAAO,CAC3B,CAAC,MAAM,IAAIC,OAAO,CAACC,OAAO,CAACF,OAAO,CAAC,GAAG,CAAC,EAAE,CACvC,IAAIG,OAAO,GAAG,MAAMd,GAAG,CAACG,MAAM,CAACY,iBAAiB,CAACJ,OAAO,CAAC,CAACK,KAAK,CAAC,CAACC,KAAK,KAAKC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC,CAAC;UAC9F,IAAI,EAACH,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEM,YAAY,GAAE;YAC1B,MAAMC,GAAG,GAAGV,OAAO,CAACW,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YACjC,OAAOrB,GAAG,CAACsB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;cAC1BC,QAAQ,EAAE,IAAI;cACdF,MAAM,EAAE,WAAW;cACnBG,OAAO,EAAG,YAAWL,GAAI;YAC3B,CAAC,CAAC;UACJ,CAAC,MAAM;YACL,IAAIT,OAAO,CAACC,OAAO,CAACC,OAAO,CAACa,EAAE,CAACC,WAAW,CAAC,GAAG,CAAC,EAAE;cAC/ChB,OAAO,CAACiB,IAAI,CAACf,OAAO,CAACa,EAAE,CAACC,WAAW,CAAC;YACtC;YACAvB,QAAQ,CAACK,KAAK,CAAC,GAAGI,OAAO,CAACa,EAAE,CAACC,WAAW;UAC1C;QACF;QACAlB,KAAK,EAAE;MACT;MACAV,GAAG,CAACO,IAAI,CAACC,KAAK,GAAGH,QAAQ;IAC3B,CAAC,MAAM;MACL,OAAOJ,GAAG,CAACsB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,QAAQ,EAAE,IAAI;QACdF,MAAM,EAAE,cAAc;QACtBG,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IACAxB,IAAI,EAAE;EACR,CAAC,CAAC,OAAOe,KAAK,EAAE;IACdjB,GAAG,CAAC8B,MAAM,CAACb,KAAK,CAACA,KAAK,CAAC;IACvB,OAAOhB,GAAG,CAACsB,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BC,QAAQ,EAAE,IAAI;MACdF,MAAM,EAAE,cAAc;MACtBG,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;AACF;AACA,IAAId,OAAO,GAAG,EAAE"}