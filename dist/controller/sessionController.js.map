{"version":3,"file":"sessionController.js","names":["SessionUtil","CreateSessionUtil","downloadFileFunction","message","client","logger","buffer","decryptFile","filename","t","fs","existsSync","result","type","mime","extension","mimetype","writeFile","err","error","e","warn","downloadMedia","download","path","replace","startAllSessions","req","res","secretkey","params","authorization","token","headers","tokenDecrypt","undefined","split","allSessions","getAllTokens","serverOptions","secretKey","status","json","response","map","session","util","opendata","showAllSessions","arr","Object","keys","clientsArray","forEach","item","push","startSession","waitQrCode","body","getSessionState","closeSession","clearSession","sessionFolder","config","customUserDataDir","console","log","rmdirSync","recursive","close","io","emit","callWebHook","connected","logOutSession","logout","checkConnectionSession","isConnected","downloadMediaByMessage","messageId","isMedia","getMessageById","isMMS","base64","toString","getMediaByMessage","ex","qr","urlcode","QRCode","toDataURL","qrcode","version","getQrCode","img","Buffer","from","writeHead","length","end","killServiceWorker","restartService","subscribePresence","phone","isGroup","all","contacts","groups","getAllGroups","p","id","_serialized","chats","getAllContacts","c","contato","contactToArray"],"sources":["../../src/controller/sessionController.js"],"sourcesContent":["/*\n * Copyright 2021 WPPConnect Team\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { clientsArray } from '../util/sessionUtil';\nimport { callWebHook, contactToArray } from '../util/functions';\nimport CreateSessionUtil from '../util/createSessionUtil';\nimport getAllTokens from '../util/getAllTokens';\nimport fs from 'fs';\nimport mime from 'mime-types';\nimport { version } from '../../package.json';\nimport QRCode from 'qrcode';\nimport config from '../config.json';\n\nconst SessionUtil = new CreateSessionUtil();\n\nasync function downloadFileFunction(message, client, logger) {\n  try {\n    const buffer = await client.decryptFile(message);\n\n    let filename = `./WhatsAppImages/file${message.t}`;\n    if (!fs.existsSync(filename)) {\n      let result = '';\n      if (message.type === 'ptt') {\n        result = `${filename}.oga`;\n      } else {\n        result = `${filename}.${mime.extension(message.mimetype)}`;\n      }\n\n      await fs.writeFile(result, buffer, (err) => {\n        if (err) {\n          logger.error(err);\n        }\n      });\n\n      return result;\n    } else {\n      return `${filename}.${mime.extension(message.mimetype)}`;\n    }\n  } catch (e) {\n    logger.error(e);\n    logger.warn('Erro ao descriptografar a midia, tentando fazer o download direto...');\n    try {\n      const buffer = await client.downloadMedia(message);\n      const filename = `./WhatsAppImages/file${message.t}`;\n      if (!fs.existsSync(filename)) {\n        let result = '';\n        if (message.type === 'ptt') {\n          result = `${filename}.oga`;\n        } else {\n          result = `${filename}.${mime.extension(message.mimetype)}`;\n        }\n\n        await fs.writeFile(result, buffer, (err) => {\n          if (err) {\n            logger.error(err);\n          }\n        });\n\n        return result;\n      } else {\n        return `${filename}.${mime.extension(message.mimetype)}`;\n      }\n    } catch (e) {\n      logger.error(e);\n      logger.warn('Não foi possível baixar a mídia...');\n    }\n  }\n}\n\nexport async function download(message, client, logger) {\n  try {\n    const path = await downloadFileFunction(message, client, logger);\n    return path.replace('./', '');\n  } catch (e) {\n    logger.error(e);\n  }\n}\n\nexport async function startAllSessions(req, res) {\n  const { secretkey } = req.params;\n  const { authorization: token } = req.headers;\n\n  let tokenDecrypt = '';\n\n  if (secretkey === undefined) {\n    tokenDecrypt = token.split(' ')[0];\n  } else {\n    tokenDecrypt = secretkey;\n  }\n\n  const allSessions = await getAllTokens(req);\n\n  if (tokenDecrypt !== req.serverOptions.secretKey) {\n    return res.status(400).json({\n      response: 'error',\n      message: 'The token is incorrect',\n    });\n  }\n\n  allSessions.map(async (session) => {\n    const util = new CreateSessionUtil();\n    await util.opendata(req, session);\n  });\n\n  return await res.status(201).json({ status: 'success', message: 'Starting all sessions' });\n}\n\nexport async function showAllSessions(req, res) {\n  const { secretkey } = req.params;\n  const { authorization: token } = req.headers;\n\n  let tokenDecrypt = '';\n\n  if (secretkey === undefined) {\n    tokenDecrypt = token.split(' ')[0];\n  } else {\n    tokenDecrypt = secretkey;\n  }\n\n  const arr = [];\n\n  if (tokenDecrypt !== req.serverOptions.secretKey) {\n    return res.status(400).json({\n      response: false,\n      message: 'The token is incorrect',\n    });\n  }\n\n  Object.keys(clientsArray).forEach((item) => {\n    arr.push({ session: item });\n  });\n\n  return res.status(200).json({ response: arr });\n}\n\nexport async function startSession(req, res) {\n  const session = req.session;\n  const { waitQrCode = false } = req.body;\n\n  await getSessionState(req, res);\n  await SessionUtil.opendata(req, session, waitQrCode ? res : null);\n}\n\nexport async function closeSession(req, res) {\n  const session = req.session;\n  const { clearSession = true } = req.body;\n  try {\n    if (clientsArray[session].status === null) {\n      return await res.status(200).json({ status: true, message: 'Session successfully closed' });\n    } else {\n      clientsArray[session] = { status: null };\n\n      if (clearSession) {\n        let sessionFolder = `${config.customUserDataDir}/${session}`;\n        if (fs.existsSync(sessionFolder)) {\n          console.log('Deletando pasta: ' + sessionFolder);\n          fs.rmdirSync(sessionFolder, { recursive: true });\n        }\n      }\n      await req.client.close();\n      req.io.emit('whatsapp-status', false);\n      callWebHook(req.client, req, 'closesession', {\n        message: `Session: ${session} disconnected`,\n        connected: false,\n      });\n\n      return await res.status(200).json({ status: true, message: 'Session successfully closed' });\n    }\n  } catch (error) {\n    req.logger.error(error);\n    return await res.status(500).json({ status: false, message: 'Error closing session', error });\n  }\n}\n\nexport async function logOutSession(req, res) {\n  try {\n    const session = req.session;\n    await req.client.logout();\n\n    req.io.emit('whatsapp-status', false);\n    callWebHook(req.client, req, 'logoutsession', {\n      message: `Session: ${session} logged out`,\n      connected: false,\n    });\n\n    return await res.status(200).json({ status: true, message: 'Session successfully closed' });\n  } catch (error) {\n    req.logger.error(error);\n    return await res.status(500).json({ status: false, message: 'Error closing session', error });\n  }\n}\n\nexport async function checkConnectionSession(req, res) {\n  try {\n    await req.client.isConnected();\n\n    return res.status(200).json({ status: true, message: 'Connected' });\n  } catch (error) {\n    return res.status(200).json({ status: false, message: 'Disconnected' });\n  }\n}\n\nexport async function downloadMediaByMessage(req, res) {\n  const client = req.client;\n  const { messageId } = req.body;\n\n  let message;\n\n  try {\n    if (!messageId.isMedia || !messageId.type) {\n      message = await client.getMessageById(messageId);\n    } else {\n      message = messageId;\n    }\n\n    if (!message)\n      return res.status(400).json({\n        status: 'error',\n        message: 'Message not found',\n      });\n\n    if (!(message['mimetype'] || message.isMedia || message.isMMS))\n      return res.status(400).json({\n        status: 'error',\n        message: 'Message does not contain media',\n      });\n\n    const buffer = await client.decryptFile(message);\n\n    return res.status(200).json({ base64: buffer.toString('base64'), mimetype: message.mimetype });\n  } catch (e) {\n    req.logger.error(e);\n    return res.status(400).json({\n      status: 'error',\n      message: 'Decrypt file error',\n      error: e,\n    });\n  }\n}\n\nexport async function getMediaByMessage(req, res) {\n  const client = req.client;\n  const { messageId } = req.params;\n\n  try {\n    const message = await client.getMessageById(messageId);\n\n    if (!message)\n      return res.status(400).json({\n        status: 'error',\n        message: 'Message not found',\n      });\n\n    if (!(message['mimetype'] || message.isMedia || message.isMMS))\n      return res.status(400).json({\n        status: 'error',\n        message: 'Message does not contain media',\n      });\n\n    const buffer = await client.decryptFile(message);\n\n    return res.status(200).json({ base64: buffer.toString('base64'), mimetype: message.mimetype });\n  } catch (ex) {\n    req.logger.error(ex);\n    return res.status(500).json({ status: 'error', message: 'The session is not active', error: ex });\n  }\n}\n\nexport async function getSessionState(req, res) {\n  try {\n    const { waitQrCode = false } = req.body;\n    const client = req.client;\n    const qr = client?.urlcode != null && client?.urlcode != '' ? await QRCode.toDataURL(client.urlcode) : null;\n\n    if ((client == null || client.status == null) && !waitQrCode)\n      return res.status(200).json({ status: 'CLOSED', qrcode: null });\n    else if (client != null)\n      return res.status(200).json({\n        status: client.status,\n        qrcode: qr,\n        urlcode: client.urlcode,\n        version: version,\n      });\n  } catch (ex) {\n    req.logger.error(ex);\n    return res.status(500).json({ status: 'error', message: 'The session is not active', error: ex });\n  }\n}\n\nexport async function getQrCode(req, res) {\n  try {\n    if (req.client.urlcode) {\n      const qr = req.client.urlcode ? await QRCode.toDataURL(req.client.urlcode) : null;\n      const img = Buffer.from(qr.replace(/^data:image\\/(png|jpeg|jpg);base64,/, ''), 'base64');\n\n      res.writeHead(200, {\n        'Content-Type': 'image/png',\n        'Content-Length': img.length,\n      });\n      res.end(img);\n    } else {\n      return res.status(200).json({ status: req.client.status, message: 'QRCode is not available...' });\n    }\n  } catch (ex) {\n    req.logger.error(ex);\n    return res.status(500).json({ status: 'error', message: 'Error retrieving QRCode', error: ex });\n  }\n}\n\nexport async function killServiceWorker(req, res) {\n  try {\n    return res.status(200).json({ status: 'success', response: req.client.killServiceWorker() });\n  } catch (ex) {\n    req.logger.error(ex);\n    return res.status(500).json({ status: 'error', message: 'The session is not active', error: ex });\n  }\n}\n\nexport async function restartService(req, res) {\n  try {\n    return res.status(200).json({ status: 'success', response: req.client.restartService() });\n  } catch (ex) {\n    req.logger.error(ex);\n    return res.status(500).json({ status: 'error', response: { message: 'The session is not active', error: ex } });\n  }\n}\n\nexport async function subscribePresence(req, res) {\n  try {\n    const { phone, isGroup = false, all = false } = req.body;\n\n    if (all) {\n      let contacts;\n      if (isGroup) {\n        const groups = await req.client.getAllGroups(false);\n        contacts = groups.map((p) => p.id._serialized);\n      } else {\n        const chats = await req.client.getAllContacts();\n        contacts = chats.map((c) => c.id._serialized);\n      }\n      await req.client.subscribePresence(contacts);\n    } else\n      for (const contato of contactToArray(phone, isGroup)) {\n        await req.client.subscribePresence(contato);\n      }\n\n    return await res.status(200).json({ status: 'success', response: { message: 'Subscribe presence executed' } });\n  } catch (error) {\n    return await res.status(500).json({ status: 'error', message: 'Error on subscribe presence', error: error });\n  }\n}\n"],"mappings":"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"}