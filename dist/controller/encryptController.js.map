{"version":3,"file":"encryptController.js","names":["saltRounds","encryptSession","req","res","session","secretkey","params","authorization","token","headers","secureTokenEnv","serverOptions","secretKey","tokenDecrypt","undefined","split","status","json","response","message","bcrypt","hash","err","hashFormat","replace","full"],"sources":["../../src/controller/encryptController.js"],"sourcesContent":["/*\n * Copyright 2021 WPPConnect Team\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport bcrypt from 'bcrypt';\n\nconst saltRounds = 10;\n\nexport async function encryptSession(req, res) {\n  const { session, secretkey } = req.params;\n  const { authorization: token } = req.headers;\n  const secureTokenEnv = req.serverOptions.secretKey;\n\n  let tokenDecrypt = '';\n\n  if (secretkey === undefined) {\n    tokenDecrypt = token.split(' ')[0];\n  } else {\n    tokenDecrypt = secretkey;\n  }\n\n  if (tokenDecrypt !== secureTokenEnv) {\n    return res.status(400).json({\n      response: false,\n      message: 'The SECRET_KEY is incorrect',\n    });\n  }\n\n  bcrypt.hash(session + secureTokenEnv, saltRounds, function (err, hash) {\n    if (err) return res.status(500).json(err);\n\n    const hashFormat = hash.replace(/\\//g, '_').replace(/\\+/g, '-');\n    return res.status(201).json({\n      status: 'success',\n      session: session,\n      token: hashFormat,\n      full: `${session}:${hashFormat}`,\n    });\n  });\n}\n"],"mappings":";;;;;;;;;;;;;;;AAeA,wDAA4B,CAf5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAGA,MAAMA,UAAU,GAAG,EAAE,CAEd,eAAeC,cAAc,CAACC,GAAG,EAAEC,GAAG,EAAE,CAC7C,MAAM,EAAEC,OAAO,EAAEC,SAAS,CAAC,CAAC,GAAGH,GAAG,CAACI,MAAM,CACzC,MAAM,EAAEC,aAAa,EAAEC,KAAK,CAAC,CAAC,GAAGN,GAAG,CAACO,OAAO,CAC5C,MAAMC,cAAc,GAAGR,GAAG,CAACS,aAAa,CAACC,SAAS,CAElD,IAAIC,YAAY,GAAG,EAAE,CAErB,IAAIR,SAAS,KAAKS,SAAS,EAAE,CAC3BD,YAAY,GAAGL,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACpC,CAAC,MAAM,CACLF,YAAY,GAAGR,SAAS;EAC1B;;EAEA,IAAIQ,YAAY,KAAKH,cAAc,EAAE;IACnC,OAAOP,GAAG,CAACa,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BC,QAAQ,EAAE,KAAK;MACfC,OAAO,EAAE;IACX,CAAC,CAAC;EACJ;;EAEAC,eAAM,CAACC,IAAI,CAACjB,OAAO,GAAGM,cAAc,EAAEV,UAAU,EAAE,UAAUsB,GAAG,EAAED,IAAI,EAAE;IACrE,IAAIC,GAAG,EAAE,OAAOnB,GAAG,CAACa,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAACK,GAAG,CAAC;;IAEzC,MAAMC,UAAU,GAAGF,IAAI,CAACG,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAACA,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;IAC/D,OAAOrB,GAAG,CAACa,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAC1BD,MAAM,EAAE,SAAS;MACjBZ,OAAO,EAAEA,OAAO;MAChBI,KAAK,EAAEe,UAAU;MACjBE,IAAI,EAAG,GAAErB,OAAQ,IAAGmB,UAAW;IACjC,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ"}