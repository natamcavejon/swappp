{"version":3,"file":"mongodbTokenStory.js","names":["MongodbTokenStore","client","tokenStore","getToken","sessionName","result","Token","findOne","JSON","parse","stringify","config","webhook","setToken","tokenData","token","tk","_id","updateOne","save","removeToken","deleteOne","listTokens","find","map","m","module","exports"],"sources":["../../../src/util/tokenStore/mongodbTokenStory.js"],"sourcesContent":["import Token from './model/token';\n\nvar MongodbTokenStore = function (client) {\n  this.tokenStore = {\n    getToken: async (sessionName) => {\n      let result = await Token.findOne({ sessionName });\n      if (result === null) return result;\n      result = JSON.parse(JSON.stringify(result));\n      result.config = JSON.parse(result.config);\n      result.config.webhook = result.webhook;\n      client.config = result.config;\n      return result;\n    },\n    setToken: async (sessionName, tokenData) => {\n      const token = new Token(tokenData);\n      token.sessionName = sessionName;\n      token.webhook = client.config.webhook;\n      token.config = JSON.stringify(client.config);\n\n      let tk = await Token.findOne({ sessionName });\n\n      if (tk) {\n        token._id = tk._id;\n        return (await Token.updateOne({ _id: tk._id }, token)) ? true : false;\n      } else {\n        return (await token.save()) ? true : false;\n      }\n    },\n    removeToken: async (sessionName) => {\n      return (await Token.deleteOne({ sessionName })) ? true : false;\n    },\n    listTokens: async () => {\n      const result = await Token.find();\n      return result.map((m) => m.sessionName);\n    },\n  };\n};\n\nmodule.exports = MongodbTokenStore;\n"],"mappings":"kGAAA;;AAEA,IAAIA,iBAAiB,GAAG,UAAUC,MAAM,EAAE;EACxC,IAAI,CAACC,UAAU,GAAG;IAChBC,QAAQ,EAAE,OAAOC,WAAW,KAAK;MAC/B,IAAIC,MAAM,GAAG,MAAMC,cAAK,CAACC,OAAO,CAAC,EAAEH,WAAW,CAAC,CAAC,CAAC;MACjD,IAAIC,MAAM,KAAK,IAAI,EAAE,OAAOA,MAAM;MAClCA,MAAM,GAAGG,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACL,MAAM,CAAC,CAAC;MAC3CA,MAAM,CAACM,MAAM,GAAGH,IAAI,CAACC,KAAK,CAACJ,MAAM,CAACM,MAAM,CAAC;MACzCN,MAAM,CAACM,MAAM,CAACC,OAAO,GAAGP,MAAM,CAACO,OAAO;MACtCX,MAAM,CAACU,MAAM,GAAGN,MAAM,CAACM,MAAM;MAC7B,OAAON,MAAM;IACf,CAAC;IACDQ,QAAQ,EAAE,OAAOT,WAAW,EAAEU,SAAS,KAAK;MAC1C,MAAMC,KAAK,GAAG,IAAIT,cAAK,CAACQ,SAAS,CAAC;MAClCC,KAAK,CAACX,WAAW,GAAGA,WAAW;MAC/BW,KAAK,CAACH,OAAO,GAAGX,MAAM,CAACU,MAAM,CAACC,OAAO;MACrCG,KAAK,CAACJ,MAAM,GAAGH,IAAI,CAACE,SAAS,CAACT,MAAM,CAACU,MAAM,CAAC;;MAE5C,IAAIK,EAAE,GAAG,MAAMV,cAAK,CAACC,OAAO,CAAC,EAAEH,WAAW,CAAC,CAAC,CAAC;;MAE7C,IAAIY,EAAE,EAAE;QACND,KAAK,CAACE,GAAG,GAAGD,EAAE,CAACC,GAAG;QAClB,OAAO,CAAC,MAAMX,cAAK,CAACY,SAAS,CAAC,EAAED,GAAG,EAAED,EAAE,CAACC,GAAG,CAAC,CAAC,EAAEF,KAAK,CAAC,IAAI,IAAI,GAAG,KAAK;MACvE,CAAC,MAAM;QACL,OAAO,CAAC,MAAMA,KAAK,CAACI,IAAI,EAAE,IAAI,IAAI,GAAG,KAAK;MAC5C;IACF,CAAC;IACDC,WAAW,EAAE,OAAOhB,WAAW,KAAK;MAClC,OAAO,CAAC,MAAME,cAAK,CAACe,SAAS,CAAC,EAAEjB,WAAW,CAAC,CAAC,CAAC,IAAI,IAAI,GAAG,KAAK;IAChE,CAAC;IACDkB,UAAU,EAAE,YAAY;MACtB,MAAMjB,MAAM,GAAG,MAAMC,cAAK,CAACiB,IAAI,EAAE;MACjC,OAAOlB,MAAM,CAACmB,GAAG,CAAC,CAACC,CAAC,KAAKA,CAAC,CAACrB,WAAW,CAAC;IACzC;EACF,CAAC;AACH,CAAC;;AAEDsB,MAAM,CAACC,OAAO,GAAG3B,iBAAiB"}