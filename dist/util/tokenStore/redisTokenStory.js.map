{"version":3,"file":"redisTokenStory.js","names":["RedisTokenStore","client","prefix","config","db","redisPrefix","getIPAddress","tokenStore","getToken","sessionName","Promise","resolve","reject","redisClient","get","err","reply","object","JSON","parse","Object","keys","length","webhook","setToken","tokenData","set","stringify","removeToken","del","listTokens","forEach","item","indice","includes","substring","indexOf","module","exports"],"sources":["../../../src/util/tokenStore/redisTokenStory.js"],"sourcesContent":["import redisClient from '../db/redis/db';\nimport config from '../../config.json';\nimport { getIPAddress } from '../functions';\n\nvar RedisTokenStore = function (client) {\n  let prefix = config.db.redisPrefix || '';\n  if (prefix === 'docker') {\n    prefix = getIPAddress();\n  }\n  this.tokenStore = {\n    getToken: (sessionName) =>\n      new Promise((resolve, reject) => {\n        redisClient.get(prefix + sessionName, (err, reply) => {\n          if (err) {\n            return reject(err);\n          }\n          const object = JSON.parse(reply);\n          if (object) {\n            if (object.config && Object.keys(client.config).length === 0) client.config = object.config;\n            if (object.webhook && Object.keys(client.config).length === 0) client.config.webhook = object.webhook;\n          }\n          resolve(object);\n        });\n      }),\n    setToken: (sessionName, tokenData) =>\n      new Promise((resolve) => {\n        tokenData.sessionName = sessionName;\n        tokenData.config = client.config;\n        redisClient.set(prefix + sessionName, JSON.stringify(tokenData), (err) => {\n          return resolve(err ? false : true);\n        });\n      }),\n    removeToken: (sessionName) =>\n      new Promise((resolve) => {\n        redisClient.del(prefix + sessionName, (err) => {\n          return resolve(err ? false : true);\n        });\n      }),\n    listTokens: () =>\n      new Promise((resolve) => {\n        redisClient.keys(prefix + '*', (err, keys) => {\n          if (err) {\n            return resolve([]);\n          }\n          keys.forEach((item, indice) => {\n            if (prefix !== '' && item.includes(prefix)) {\n              keys[indice] = item.substring(item.indexOf(prefix) + prefix.length);\n            }\n          });\n          return resolve(keys);\n        });\n      }),\n  };\n};\n\nmodule.exports = RedisTokenStore;\n"],"mappings":"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"}