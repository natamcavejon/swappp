{"version":3,"file":"createSessionUtil.js","names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","request","fs","_sessionUtil","_wppconnect","_functions","_sessionController","_factory","_chatWootClient","CreateSessionUtil","startChatWootClient","client","config","chatWoot","session","createSessionUtil","req","clientsArray","res","getClient","status","body","tokenStore","myTokenStore","createTokenStory","getToken","serverOptions","customUserDataDir","createOptions","puppeteerOptions","userDataDir","wppClient","create","assign","deviceName","poweredBy","catchQR","base64Qr","asciiQR","attempt","urlCode","exportQR","onLoadingScreen","percent","message","logger","info","statusFind","eventEmitter","emit","qrcode","close","undefined","callWebHook","error","start","webhook","onParticipantsChanged","onReactionMessage","onRevokedMessage","onPollResponse","e","opendata","qrCode","urlcode","replace","imageBuffer","Buffer","from","io","data","toString","_headerSent","json","isConnected","startHelper","checkStateSession","listenMessages","listenAcks","onPresenceChanged","onStateChange","state","conflits","SocketState","CONFLICT","includes","useHere","onMessage","console","log","writeFile","err","type","onLiveLocation","sender","id","location","onAnyMessage","download","response","onIncomingCall","call","onAck","ack","presenceChangedEvent","reaction","encodeFunction","JSON","stringify","decodeFunction","text","object","parse"],"sources":["../../src/util/createSessionUtil.js"],"sourcesContent":["\"use strict\";var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports, \"__esModule\", { value: true });exports.default = void 0;\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst request = require('request');\nconst fs = require('fs');\nvar _sessionUtil = require(\"./sessionUtil\");\nvar _wppconnect = require(\"@wppconnect-team/wppconnect\");\nvar _functions = require(\"./functions\");\nvar _sessionController = require(\"../controller/sessionController\");\nvar _factory = _interopRequireDefault(require(\"./tokenStore/factory\"));\nvar _chatWootClient = _interopRequireDefault(require(\"./chatWootClient\")); /*\n* Copyright 2021 WPPConnect Team\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*     http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/class CreateSessionUtil {startChatWootClient(client) {if (client.config.chatWoot && !client._chatWootClient) client._chatWootClient = new _chatWootClient.default(client.config.chatWoot, client.session);return client._chatWootClient;}async createSessionUtil(req, clientsArray, session, res) {try {let client = this.getClient(session);if (client.status != null && client.status !== 'CLOSED') return;client.status = 'INITIALIZING';client.config = req.body;\n\n      const tokenStore = new _factory.default();\n      const myTokenStore = tokenStore.createTokenStory(client);\n\n      await myTokenStore.getToken(session);\n      this.startChatWootClient(client);\n\n      if (req.serverOptions.customUserDataDir) {\n        req.serverOptions.createOptions.puppeteerOptions = {\n          userDataDir: req.serverOptions.customUserDataDir + session\n        };\n      }\n\n      let wppClient = await (0, _wppconnect.create)(\n      Object.assign({}, { tokenStore: myTokenStore }, req.serverOptions.createOptions, {\n        session: session,\n        deviceName: req.serverOptions.deviceName,\n        poweredBy: req.serverOptions.poweredBy || 'WPPConnect-Server',\n        catchQR: (base64Qr, asciiQR, attempt, urlCode) => {\n          this.exportQR(req, base64Qr, urlCode, client, res);\n        },\n        onLoadingScreen: (percent, message) => {\n          req.logger.info(`[${session}] ${percent}% - ${message}`);\n        },\n        statusFind: (statusFind) => {\n          try {\n            _sessionUtil.eventEmitter.emit(`status-${client.session}`, client, statusFind);\n            if (statusFind === 'autocloseCalled' || statusFind === 'desconnectedMobile') {\n              client.status = 'CLOSED';\n              client.qrcode = null;\n              client.close();\n              clientsArray[session] = undefined;\n            }\n            (0, _functions.callWebHook)(client, req, 'status-find', { status: statusFind });\n            req.logger.info(statusFind + '\\n\\n');\n          } catch (error) {}\n        }\n      }));\n\n\n      client = clientsArray[session] = Object.assign(wppClient, client);\n      await this.start(req, client);\n\n      if (req.serverOptions.webhook.onParticipantsChanged) {\n        await this.onParticipantsChanged(req, client);\n      }\n\n      if (req.serverOptions.webhook.onReactionMessage) {\n        await this.onReactionMessage(client, req);\n      }\n\n      if (req.serverOptions.webhook.onRevokedMessage) {\n        await this.onRevokedMessage(client, req);\n      }\n\n      if (req.serverOptions.webhook.onPollResponse) {\n        await this.onPollResponse(client, req);\n      }\n    } catch (e) {\n      req.logger.error(e);\n    }\n  }\n\n  async opendata(req, session, res) {\n    await this.createSessionUtil(req, _sessionUtil.clientsArray, session, res);\n  }\n\n  exportQR(req, qrCode, urlCode, client, res) {\n    _sessionUtil.eventEmitter.emit(`qrcode-${client.session}`, qrCode, urlCode, client);\n    Object.assign(client, {\n      status: 'QRCODE',\n      qrcode: qrCode,\n      urlcode: urlCode\n    });\n\n    qrCode = qrCode.replace('data:image/png;base64,', '');\n    const imageBuffer = Buffer.from(qrCode, 'base64');\n\n    req.io.emit('qrCode', {\n      data: 'data:image/png;base64,' + imageBuffer.toString('base64'),\n      session: client.session\n    });\n\n    (0, _functions.callWebHook)(client, req, 'qrcode', { qrcode: qrCode, urlcode: urlCode });\n    if (res && !res._headerSent) res.status(200).json({ status: 'qrcode', qrcode: qrCode, urlcode: urlCode });\n  }\n\n  async onParticipantsChanged(req, client) {\n    await client.isConnected();\n    await client.onParticipantsChanged((message) => {\n      (0, _functions.callWebHook)(client, req, 'onparticipantschanged', message);\n    });\n  }\n\n  async start(req, client) {\n    try {\n      await client.isConnected();\n      Object.assign(client, { status: 'CONNECTED', qrcode: null });\n\n      req.logger.info(`Started Session: ${client.session}`);\n      //callWebHook(client, req, 'session-logged', { status: 'CONNECTED'});\n      req.io.emit('session-logged', { status: true, session: client.session });\n      (0, _functions.startHelper)(client, req);\n    } catch (error) {\n      req.logger.error(error);\n      req.io.emit('session-error', client.session);\n    }\n\n    await this.checkStateSession(client, req);\n    await this.listenMessages(client, req);\n\n    if (req.serverOptions.webhook.listenAcks) {\n      await this.listenAcks(client, req);\n    }\n\n    if (req.serverOptions.webhook.onPresenceChanged) {\n      await this.onPresenceChanged(client, req);\n    }\n  }\n\n  async checkStateSession(client, req) {\n    await client.onStateChange((state) => {\n      req.logger.info(`State Change ${state}: ${client.session}`);\n      const conflits = [_wppconnect.SocketState.CONFLICT];\n\n      if (conflits.includes(state)) {\n        client.useHere();\n      }\n    });\n  }\n\n  async listenMessages(client, req) {\n    await client.onMessage(async (message) => {\n      console.log('aq', message.body);\n      fs.writeFile('message.txt',message.body,(err)=>{if(err) throw err;\n      console.log('boa')})\n      _sessionUtil.eventEmitter.emit(`mensagem-${client.session}`, client, message);\n      (0, _functions.callWebHook)(client, req, 'onmessage', message);\n      if (message.type === 'location')\n      client.onLiveLocation(message.sender.id, (location) => {\n        (0, _functions.callWebHook)(client, req, 'location', location);\n      });\n    });\n    await client.onAnyMessage((message) => {\n      message.session = client.session;\n\n      if (message.type === 'sticker') {\n        (0, _sessionController.download)(message, client, req.logger);\n      }\n\n      req.io.emit('received-message', { response: message });\n    });\n\n    await client.onIncomingCall(async (call) => {\n      req.io.emit('incomingcall', call);\n      (0, _functions.callWebHook)(client, req, 'incomingcall', call);\n    });\n  }\n\n  async listenAcks(client, req) {\n    await client.onAck(async (ack) => {\n      req.io.emit('onack', ack);\n      (0, _functions.callWebHook)(client, req, 'onack', ack);\n    });\n  }\n\n  async onPresenceChanged(client, req) {\n    await client.onPresenceChanged(async (presenceChangedEvent) => {\n      req.io.emit('onpresencechanged', presenceChangedEvent);\n      (0, _functions.callWebHook)(client, req, 'onpresencechanged', presenceChangedEvent);\n    });\n  }\n\n  async onReactionMessage(client, req) {\n    await client.isConnected();\n    await client.onReactionMessage(async (reaction) => {\n      req.io.emit('onreactionmessage', reaction);\n      (0, _functions.callWebHook)(client, req, 'onreactionmessage', reaction);\n    });\n  }\n\n  async onRevokedMessage(client, req) {\n    await client.isConnected();\n    await client.onRevokedMessage(async (response) => {\n      req.io.emit('onrevokedmessage', response);\n      (0, _functions.callWebHook)(client, req, 'onrevokedmessage', response);\n    });\n  }\n  async onPollResponse(client, req) {\n    await client.isConnected();\n    await client.onPollResponse(async (response) => {\n      req.io.emit('onpollresponse', response);\n      (0, _functions.callWebHook)(client, req, 'onpollresponse', response);\n    });\n  }\n\n  encodeFunction(data, webhook) {\n    data.webhook = webhook;\n    return JSON.stringify(data);\n  }\n\n  decodeFunction(text, client) {\n    let object = JSON.parse(text);\n    if (object.webhook && !client.webhook) client.webhook = object.webhook;\n    delete object.webhook;\n    return object;\n  }\n\n  getClient(session) {\n    let client = _sessionUtil.clientsArray[session];\n\n    if (!client) client = _sessionUtil.clientsArray[session] = { status: null, session: session };\n    return client;\n  }\n}exports.default = CreateSessionUtil;\n//# sourceMappingURL=createSessionUtil.js.map"],"mappings":"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"}